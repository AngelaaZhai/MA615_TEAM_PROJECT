---
title: "Assignment 3"
author: "Yudi Mao/Longhao Chen/Tianying Xu/Xiaolu Zai"
date: "9/30/2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

## Iron&Steel import changes from major countries through 2015-2018

Data used is from data of import of the United States.(https://usatrade.census.gov/data)

```{r}
library(tidyverse)
library(readxl)
library(magrittr)

#Input data
usaimport_ds <- read_xlsx("usaimport.xlsx")
colnames(usaimport_ds) <- c("Commodity","Country","Time","Money")

#Filter the subset
iron_steel <- filter(usaimport_ds, Commodity == "72 Iron And Steel")

#Transfor money to per million
iron_steel$Money <- round(as.numeric(iron_steel$Money) / 1000000, 1)
```

## Pic.1 Import throughout a year

We use average import per month to predict 2018.

```{r}
#Predict 2018
iron_steel$Time[which(iron_steel$Time == "2018 through July")] <- "predicted 2018"
iron_steel$Money[which(iron_steel$Time == "2018")] <- round(iron_steel$Money[which(iron_steel$Time == "predicted 2018")]*12/7, 1)

year_ds <- filter(iron_steel, Time %in% c("2015", "2016", "2017", "predicted 2018"))

#Histogram of different countries and areas
ggplot(data = year_ds) +
  geom_bar(mapping = aes(x = Time, y = Money, fill = Country), stat = "identity") +
  ggtitle("Import of different countries and areas per year, by Yudi Mao")
```

From this histogram, we can roughly conclude that iron&steel import from China decreased these years, especially 2016 compared to 2015. Import from European Union roughly remained the same level, although its predicted amount of 2018 will also decrease, but slightly.

However, we notice that the amount of iron&steel import from European Union is far larger than others, which makes other countries hard to intepret. Meanwhile, we have drawed conclusion between China and EU. Thus:

In next histogram, EU will be removed, and other countries will be showed in their proportion of import of the United States.

## Pic.2 Proportion of each country (European Union excluded)

```{r}
#Exclude EU
year_ds_euex <- filter(year_ds, Country != "European Union")

#Histogram of proportion
ggplot(data = year_ds_euex) +
  geom_bar(mapping = aes(x = Time, y = Money, fill = Country), stat = "identity", position = "fill") +
  ggtitle("Import proportion of different countries per year, by Yudi Mao")
```

In pic.2, we can roughly conclude that inport from China decreased from 2015-2017, while inport from Germany and Italy increased. Other countries roughly remained the same level.

## Pic.3 Line chart of inport per month of China and European Union through 2017-2018

In this picture, we will only use data of China and EU, but more precise from yearly data to monthly data.

```{r}
#data of China and EU per month
month_ds <- filter(iron_steel, !Time %in% c("2015", "2016", "2017", "predicted 2018"))
month_ds <- filter(month_ds, Country %in% c("China", "European Union"))

#Curve the line
ggplot(data = month_ds) +
  geom_bar(mapping = aes(x = Time, y = Money, fill = Country), stat = "identity", position = "dodge") +
  ggtitle("Import of China and EU per month, by Yudi Mao") +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5))
```

Roughly, both import from China and EU per month fluctuated among 2017-2018.



#The following portiong of HW_3 is contributed by Longhao Chen.


Data (how you generated it)

The method I generate the data is to first find the raw data from this website 

https://www.census.gov/foreign-trade/index.html 

Then, I registered an account and selected the data that most interests me. Then I downloaded the data into my local computer and load it into RStudio. After some manipulation, I subset the data to a smaller size and name them liveanimalchina and aluminum.

Visualization and Discussion

```{r cars}
library(tidyverse)
library(readxl)
war <- read_xlsx("usaimport.xlsx")
colnames(war)<-c("Commodity","Country","Time","Money")
liveanimalchina<-filter(.data = war, Country =="China") %>%
  filter(str_detect(Commodity , "Live Animals"))  %>%
  filter(Money>20000000)

b<-rbind(liveanimalchina, c("01 Live Animals","China","Predicted 2018",(22919535*12)/7))
b$Money=as.numeric((b$Money))
ggplot(data = b, aes(x = Time, y = Money)) +
geom_bar(stat = "identity") +
labs(title = "Yearly live animal imported from China_Longhao Chen") +
  scale_y_continuous(limits=c(0,NA))

aluminum<-filter(.data = war, Country == "China") %>%
  filter(str_detect(Commodity, "Aluminum")) %>%
  filter(Money < 1000000000)
aluminum$Time <- factor(aluminum$Time, levels = aluminum$Time)

ggplot(data = aluminum, aes(x=Time, y = Money)) +
  geom_line(group = 1) +
  labs(title="Monthly aluminum imported from China_Longhao Chen") +
  theme(axis.text.x=element_text(angle=90,margin = margin(5, unit = "mm"),vjust =1)) +
  scale_y_continuous(limits=c(0,NA))
```

I am personally interested the impact of tariffs between China and U.S.A so I take two commodities, one is live animal and another one aluminum as examples. The first plot reveals the imported live animal in dollars from 2015 to 2018 until July. Notice that I add another bar called predicted 2018, which is generated by value of 2018 through July * 12/7. This is based on an assumption that whole year around value of aluminum is spreaded out on each month. 

What we can see from this graph is there is not huge impact on live animal based on the value of predicted 2018. However, it is likely that U.S.A will not import much live animal in the winter of 2018, which will causes the actual value to NOT match the predicted value.

The second graph zooms in for the monthly imported value of alluminum from Jan 2017 to July 2018. From this graph, we do see a decreasing value of imported alluminum in June 2018 and July 2018 compared to June 2017 and July 2017. This could be an indication of the tariffs.

Conslusion
The impact of tariffs towards the imported commodities China is starting to accumulate. However, it has different impacts towards different commodities. For aluminum, tariffs definately changes the trade between China and U.S.A. However, it is too not eacy to predict the impact on live animal. 



